<% content_for :title, "Edit Album" %>

<div class="d-flex flex-row">
    <%= render "navbar" %>
    <div class="bg-white mt-3 pt-3 w-75 container">
        <%= render "application/edit_header", title: "Edit Album" %>
        <%= form_for(@album, as: :album, url: user_album_path(@album), method: :put, local: true, html: { multipart: true }) do |f| %>
            <div class="d-flex flex-row justify-content-between mt-3 edit-album-form">
                <div class="new-field">
                    <div class="mb-4">
                        <%= f.label :title, class: "form-label text-body" %>
                        <%= f.text_field :title, class: "form-control", placeholder: "Album Title", required: true %>
                    </div>
                    <div class="mb-4">
                        <%= f.label :sharing_mode, class: "form-label text-body" %>
                        <%= f.select :isPublic, options_for_select([["Public", 1], ["Private", 0]], @album.isPublic), {}, { class: "form-select" } %>
                    </div>
                    <div class="avatar-upload-container position-relative mb-2 photo-upload">
                        <label for="avatar-upload-user">
                            <%= image_tag "square-plus-regular.jpg", class: "w-100", id: "avatar-upload-image-user" %>
                        </label>
                        <%= f.file_field :new_images, id: "avatar-upload-user", class: "images-upload", accept: "image/jpeg,image/png,image/gif", multiple: true %>
                    </div>
                    <div class="mb-4 mt-3">
                        <%= f.submit "Save", class: "btn btn-success me-4" %>
                        <div class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#delete-album-<%= @album.id %>">
                            <i class="fa-solid fa-trash me-1"></i>
                            Delete
                        </div>
                    </div>
                </div>
                <div class="new-field">
                    <%= f.label :description, class: "form-label" %>
                    <%= f.text_area :description, class: "form-control", rows: "5", placeholder: "Album Description", required: true %>
                </div>
            </div>
            <div class="container album-images d-flex flex-wrap mb-5">
                <% @album.photos.each do |photo| %>
                    <div class="position-relative mb-2 mx-1 col col-xl-3 col-md-6">
                        <%= image_tag photo.image.url, class: "w-100" %>
                        <i class="fa-solid fa-xmark position-absolute top-0 end-0 fa-2x remove-image-button" data-image-index="<%= photo.id %>"></i>
                    </div>
                <% end %>
            </div>
            <%= hidden_field_tag "album[remove_images][]", "", disabled: true, id: "remove_images" %>
        <% end %>
        <%= render "application/modal_delete", msg: "album", object: @album, url: user_album_path(@album), modal_id: "delete-album-#{@album.id}" %>
    </div>
</div>

<script>
    document.querySelectorAll('.remove-image-button').forEach(btn => {
        btn.addEventListener('click', (e) => {
            const index = btn.dataset.imageIndex;
            const input = document.getElementById('remove_images').cloneNode();
            input.disabled = false;
            input.id = "";
            input.value = index;
            document.querySelector('.edit-album-form').appendChild(input);
            btn.parentElement.style.display = 'none';
        });
    });
</script>